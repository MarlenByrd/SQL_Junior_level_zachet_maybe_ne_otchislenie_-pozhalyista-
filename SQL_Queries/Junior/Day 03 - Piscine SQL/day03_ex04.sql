WITH gender_orders AS (SELECT piz.name AS pizzeria_name, per.gender FROM person_order po JOIN menu m ON po.menu_id = m.id JOIN pizzeria piz ON m.pizzeria_id = piz.id JOIN person per ON po.person_id = per.id), male_orders AS (SELECT pizzeria_name FROM gender_orders WHERE gender = 'male'), female_orders AS (SELECT pizzeria_name FROM gender_orders WHERE gender = 'female') SELECT pizzeria_name FROM (SELECT pizzeria_name FROM male_orders EXCEPT SELECT pizzeria_name FROM female_orders) AS diff UNION SELECT pizzeria_name FROM (SELECT pizzeria_name FROM female_orders EXCEPT SELECT pizzeria_name FROM male_orders) AS diff2 ORDER BY pizzeria_name;
